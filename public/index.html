<!DOCTYPE html>
<html lang="en" style="background-color: #232723;">

<script src="profiles.js"></script>
<script src="firebaseClient.js"></script>


<script>

    function logIn() {
        localStorage.setItem('loggedIn', true)
        checkLoginState();
    }

    function logOut() {
        localStorage.removeItem('access_token');
        localStorage.setItem('loggedIn', 'false');
        checkLoginState();
    }


    function checkLoginState() {

        const loggedIn = localStorage.getItem('loggedIn') === 'true';

        const fileToLoad = loggedIn ? "main.html" : "login.html";

        fetch(fileToLoad)
            .then(res => res.text())
            .then(html => {
                document.body.innerHTML = html;
            });

    }


    window.onload = checkLoginState();

    function getQueryParam(key) {
        return new URLSearchParams(window.location.search).get(key);
    }

    const loggedIn = getQueryParam('loggedIn');
    const accessToken = getQueryParam('access_token');

    if (loggedIn || accessToken) {
        logIn();

        if (accessToken) {
            localStorage.setItem('access_token', accessToken);
        }

        window.history.replaceState({}, document.title, '/');
    }

    // ===== DYNAMIC PROFILES =====
    const grid = document.getElementById("profileGrid");

    profiles.forEach(profile => {
        const card = document.createElement("div");
        card.className = "profile-card";

        card.innerHTML = `
        <div class="usersContainer">
      <div class="profile-header">
        <img src="${profile.picture}" alt="${profile.name}" class="profile-pic">
        <span class="profile-name">${profile.name}</span>
      </div>
      <div class="song-section">
        <img src="${profile.songCover}" class="song-cover">
        <div class="songInfoContainer">
            <span class="song-title">${profile.song}</span>
            <span class="song-artist">${profile.artist}</span>
        </div>
      </div>
      </div>
    `;

        grid.appendChild(card);
    });

</script>

</html>