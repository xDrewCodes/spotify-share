<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="/home.css">
    <meta charset="UTF-8">
    <title>Sharify</title>
</head>

<!-- Navigation Bar -->
<header class="navbar mainPage" id="navbar">
    <div class="logo">Sharify</div>
    <input type="text" class="search-bar" placeholder="Search here">
    <nav class="nav-buttons">
        <a href="friends.html" class="nav-btn">Friends</a>
        <a href="following.html" class="nav-btn">Following</a>
        <a href="#" class="nav-btn sign-out">Sign Out</a>
        <a href="#">
            <img src="https://images.unsplash.com/photo-1487017931017-0e0d9e02bb0c?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                class="pfp">
        </a>
    </nav>
</header>

<!-- Page Heading -->
<section class="mainPage page-heading">
    <h1>Welcome To Sharify</h1>
    <p>Here's some suggestions!</p>
</section>


<body>
    <div class="mainLogin">
        <h1>Sharify</h1>
        <a class="button loginButton" href="/api/login">Authorize your Spotify account</a>
        <a class="button loginButton loginSecondaryButton" onClick="logIn()">Log In</a>
    </div>
</body>

<!-- Profile Grid -->
<main class="mainPage profile-grid" id="profileGrid">

    <!-- Profiles will be generated dynamically by JS -->
</main>

<script src="profiles.js"></script> <!-- include profiles.js -->

<script>

    function logIn() {
        localStorage.setItem('loggedIn', true)
        checkLoginState()
    }

    function logOut() {
        localStorage.removeItem('access_token');
        localStorage.setItem('loggedIn', 'false');
        checkLoginState();
    }


    function checkLoginState() {
        const loggedIn = localStorage.getItem('loggedIn') === 'true';

        const mainLoginEls = document.getElementsByClassName('mainLogin');
        const mainPageEls = document.getElementsByClassName('mainPage');

        if (loggedIn) {
            // Hide login, show main page
            for (let el of mainLoginEls) {
                el.style.visibility = 'hidden';
            }
            for (let el of mainPageEls) {
                el.style.visibility = 'shown';
            }
        } else {
            // Show login, hide main page
            for (let el of mainLoginEls) {
                el.style.visibility = 'shown';
            }
            for (let el of mainPageEls) {
                el.style.visibility = 'hidden';
            }
        }
    }


    window.onload = checkLoginState;

    function getQueryParam(key) {
        return new URLSearchParams(window.location.search).get(key);
    }

    const loggedIn = getQueryParam('loggedIn');
    const accessToken = getQueryParam('access_token');

    if (loggedIn || accessToken) {
        logIn();

        if (accessToken) {
            localStorage.setItem('access_token', accessToken);
        }

        window.history.replaceState({}, document.title, '/');
    }

    // ===== DYNAMIC PROFILES =====
    const grid = document.getElementById("profileGrid");

    profiles.forEach(profile => {
        const card = document.createElement("div");
        card.className = "profile-card";

        card.innerHTML = `
        <div class="usersContainer">
      <div class="profile-header">
        <img src="${profile.picture}" alt="${profile.name}" class="profile-pic">
        <span class="profile-name">${profile.name}</span>
      </div>
      <div class="song-section">
        <img src="${profile.songCover}" class="song-cover">
        <div class="songInfoContainer">
            <span class="song-title">${profile.song}</span>
            <span class="song-artist">${profile.artist}</span>
        </div>
      </div>
      </div>
    `;

        grid.appendChild(card);
    });

</script>

</html>